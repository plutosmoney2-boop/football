<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Футбольные матчи — SStats.net UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-elevated: #020617;
      --bg-card: #020617;
      --bg-soft: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.16);
      --accent-strong: rgba(34, 197, 94, 0.45);
      --accent-blue: #38bdf8;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(31,41,55,0.9);
      --border-strong: rgba(55,65,81,0.9);
      --danger: #ef4444;
      --warn: #f97316;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .shell {
      width: 100%;
      max-width: 1200px;
    }

    /* HEADER */

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .brand-block {
      max-width: 520px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: linear-gradient(120deg, rgba(34,197,94,0.16), rgba(15,23,42,0.96));
      color: var(--accent);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(34,197,94,0.3);
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    h1 {
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .title-sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .title-logo {
      width: 30px;
      height: 30px;
      border-radius: 12px;
      border: 1px solid rgba(34,197,94,0.65);
      background:
        radial-gradient(circle at top left, rgba(34,197,94,0.9), rgba(0,0,0,1));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 800;
      color: #022c22;
      box-shadow: 0 0 40px rgba(34,197,94,0.4);
    }

    .meta-block {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
      min-width: 230px;
    }

    .meta-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .meta-pill {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: #cbd5f5;
      background: radial-gradient(circle at top, rgba(148,163,184,0.2), transparent);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .meta-pill-api {
      border-color: rgba(56,189,248,0.9);
      color: #bae6fd;
      background: radial-gradient(circle at top, rgba(56,189,248,0.45), transparent);
    }

    .meta-pill-limit {
      border-color: rgba(250,204,21,0.9);
      color: #facc15;
      background: radial-gradient(circle at top, rgba(250,204,21,0.35), transparent);
    }

    /* LAYOUT */

    main {
      border-radius: 18px;
      border: 1px solid var(--border-strong);
      background:
        radial-gradient(circle at top left, rgba(34,197,94,0.16), transparent 55%),
        radial-gradient(circle at bottom right, rgba(37,99,235,0.14), transparent 60%),
        linear-gradient(145deg, rgba(15,23,42,0.98), rgba(2,6,23,1));
      box-shadow:
        0 0 0 1px rgba(15,23,42, 0.95),
        0 26px 80px rgba(15,23,42, 0.98),
        0 0 90px rgba(34,197,94,0.22);
      padding: 14px 14px 16px;
      backdrop-filter: blur(20px);
      display: grid;
      grid-template-columns: minmax(0, 2.3fr) minmax(0, 1.3fr);
      gap: 14px;
    }

    @media (max-width: 960px) {
      main {
        grid-template-columns: minmax(0,1fr);
      }
    }

    /* LEFT SIDE */

    .left-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .filters {
      background: rgba(15,23,42,0.96);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 8px;
      align-items: end;
    }

    @media (max-width: 960px) {
      .filters {
        grid-template-columns: repeat(2,minmax(0,1fr));
      }
    }

    @media (max-width: 600px) {
      .filters {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .field-control {
      position: relative;
    }

    .field select,
    .field input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,1));
      color: var(--text);
      font-size: 13px;
      outline: none;
      appearance: none;
    }

    .field input[type="date"] {
      padding-right: 26px;
    }

    .field select:focus,
    .field input:focus {
      border-color: rgba(34,197,94,0.7);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.5);
    }

    .field-hint {
      font-size: 10px;
      color: var(--text-muted);
    }

    .select-arrow {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      pointer-events: none;
      color: var(--text-muted);
    }

    .actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 7px 13px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background:
        radial-gradient(circle at top left, rgba(34,197,94,0.85), rgba(34,197,94,0.25));
      color: #022c22;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow:
        0 0 0 1px rgba(34,197,94,0.35),
        0 22px 50px rgba(16,185,129,0.4);
      transition: transform 0.08s ease-out, box-shadow 0.12s ease-out, background 0.12s ease-out, opacity 0.1s;
      white-space: nowrap;
    }

    .btn-secondary {
      border-color: rgba(148,163,184,0.9);
      background: radial-gradient(circle at top, rgba(148,163,184,0.28), rgba(15,23,42,0.96));
      color: #e5e7eb;
      box-shadow:
        0 0 0 1px rgba(148,163,184,0.35),
        0 18px 40px rgba(15,23,42,0.9);
    }

    .btn-icon {
      font-size: 11px;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow:
        0 0 0 1px rgba(34,197,94,0.5),
        0 26px 70px rgba(16,185,129,0.5);
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 0 0 1px rgba(34,197,94,0.55),
        0 18px 38px rgba(16,185,129,0.35);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
      box-shadow:
        0 0 0 1px rgba(75,85,99,0.6),
        0 12px 26px rgba(15,23,42,0.9);
    }

    .summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
      padding: 4px 2px 0;
    }

    .summary-count {
      font-weight: 500;
      color: #cbd5f5;
    }

    .summary-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px dashed rgba(148,163,184,0.7);
      font-size: 11px;
    }

    .summary-badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .error-box {
      margin-top: 4px;
      font-size: 11px;
      color: var(--danger);
      min-height: 14px;
    }

    .matches {
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      margin-top: 6px;
      padding: 8px;
      max-height: 520px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #4b5563 #020617;
    }

    .matches::-webkit-scrollbar {
      width: 6px;
    }

    .matches::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .match-card {
      border-radius: 11px;
      border: 1px solid rgba(31,41,55,0.95);
      background: linear-gradient(125deg, rgba(15,23,42,0.98), rgba(15,23,42,0.96));
      padding: 8px 8px 7px;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.5fr) auto;
      column-gap: 10px;
      row-gap: 3px;
      align-items: center;
      font-size: 12px;
      margin-bottom: 7px;
      cursor: pointer;
      transition: transform 0.08s ease-out, box-shadow 0.12s ease-out, border-color 0.1s ease-out, background 0.1s ease-out;
    }

    @media (max-width: 720px) {
      .match-card {
        grid-template-columns: minmax(0,1.8fr) minmax(0,1.4fr);
        grid-template-rows: auto auto;
      }
    }

    @media (max-width: 560px) {
      .match-card {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .match-card:hover {
      transform: translateY(-1px);
      border-color: rgba(34,197,94,0.6);
      box-shadow:
        0 18px 42px rgba(15,23,42,0.98),
        0 0 30px rgba(34,197,94,0.18);
      background: linear-gradient(125deg, rgba(15,23,42,1), rgba(5,46,22,0.96));
    }

    .match-teams {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .match-team-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .team-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .match-vs {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .match-info-line {
      font-size: 11px;
      color: var(--text-muted);
    }

    .match-info-date {
      font-size: 11px;
      color: #e5e7eb;
    }

    .match-extra {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .pill-small {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #e5e7eb;
      white-space: nowrap;
    }

    .pill-status-live {
      border-color: rgba(248,113,113,0.9);
      color: #fed7aa;
    }

    .pill-status-finished {
      border-color: rgba(34,197,94,0.9);
      color: #bbf7d0;
    }

    .pill-status-upcoming {
      border-color: rgba(148,163,184,0.9);
      color: #e5e7eb;
    }

    .empty {
      font-size: 12px;
      color: var(--text-muted);
      padding: 10px 2px 4px;
    }

    /* RIGHT SIDE */

    .right-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .panel {
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      padding: 10px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .panel-header span {
      color: var(--text-muted);
    }

    .panel-title {
      font-weight: 500;
      color: #e5e7eb;
    }

    .panel-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,0.7);
      color: #bae6fd;
      background: radial-gradient(circle at top, rgba(56,189,248,0.35), transparent);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    pre {
      margin: 0;
      padding: 8px;
      border-radius: 10px;
      background: rgba(10,15,30,0.96);
      border: 1px solid rgba(31,41,55,0.95);
      font-size: 11px;
      overflow-x: auto;
      color: #e5e7eb;
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
      line-height: 1.5;
    }

    .hint a {
      color: #38bdf8;
      text-decoration: none;
    }

    .hint a:hover {
      text-decoration: underline;
    }

    .key-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px dashed rgba(248,250,252,0.35);
      font-size: 10px;
      margin-bottom: 4px;
    }

    .key-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #facc15;
    }

    .selected-game {
      font-size: 12px;
      color: #cbd5f5;
      line-height: 1.4;
    }

    .selected-game span {
      color: var(--text-muted);
    }
  </style>
</head>
<body>
<div class="shell">
  <header>
    <div class="brand-block">
      <div class="pill">
        <span class="pill-dot"></span>
        Football data · SStats.net
      </div>
      <div class="title-row">
        <div class="title-logo">F</div>
        <h1>Матчи · Лиги · Страны</h1>
      </div>
      <p class="title-sub">
        Интерфейс для просмотра футбольных матчей: выберите дату, страну, лигу и матч, данные приходят напрямую из API SStats.net.
      </p>
    </div>
    <div class="meta-block">
      <div class="meta-row">
        <div class="meta-pill meta-pill-api">OpenAPI JSON · https://api.sstats.net</div>
        <div class="meta-pill meta-pill-limit">Free tier · rate limit</div>
      </div>
      <div class="meta-row">
        <div class="meta-pill">Слои фильтрации: дата / страна / лига / матч</div>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT SIDE -->
    <section class="left-panel">
      <div class="filters">
        <div class="field">
          <div class="field-label">Дата</div>
          <div class="field-control">
            <input type="date" id="dateInput">
          </div>
          <div class="field-hint">Фильтр по дню (по умолчанию сегодня).</div>
        </div>

        <div class="field">
          <div class="field-label">Страна</div>
          <div class="field-control">
            <select id="countrySelect">
              <option value="">Все страны</option>
            </select>
            <span class="select-arrow">▾</span>
          </div>
          <div class="field-hint">Список стран из API.</div>
        </div>

        <div class="field">
          <div class="field-label">Лига</div>
          <div class="field-control">
            <select id="leagueSelect">
              <option value="">Все лиги</option>
            </select>
            <span class="select-arrow">▾</span>
          </div>
          <div class="field-hint">Фильтр по лиге (внутри страны).</div>
        </div>

        <div class="field">
          <div class="field-label">Загрузка</div>
          <div class="field-control actions">
            <button class="btn" id="btnLoad">
              <span class="btn-icon">●</span>
              <span>Загрузить матчи</span>
            </button>
            <button class="btn btn-secondary" id="btnToday">
              <span class="btn-icon">↻</span>
              <span>Сегодня</span>
            </button>
          </div>
          <div class="field-hint">Обновить список матчей.</div>
        </div>
      </div>

      <div class="summary">
        <div>
          <span id="summaryText">Выберите фильтры и нажмите «Загрузить матчи».</span>
        </div>
        <div class="summary-badge">
          <span class="summary-badge-dot"></span>
          <span id="summaryCount">0 матчей</span>
        </div>
      </div>
      <div class="error-box" id="errorBox"></div>

      <div class="matches" id="matchesList">
        <div class="empty">Список матчей пока пуст. Нажмите «Загрузить матчи».</div>
      </div>
    </section>

    <!-- RIGHT SIDE -->
    <section class="right-panel">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">HTTP запрос к API</span>
          <span class="panel-badge">REST · JSON</span>
        </div>
        <pre><code id="requestPreview">GET https://api.sstats.net/games/list?today=true
Accept: application/json
X-Api-Key: YOUR_API_KEY_HERE</code></pre>
        <div class="hint">
          Эндпоинты SStats.net возвращают футбольные данные в форматах JSON и CSV; внутренняя документация доступна по адресу <a href="https://api.sstats.net/docs" target="_blank" rel="noreferrer">api.sstats.net/docs</a>. [web:2][web:4]<br>
          Параметры примера:
          <br>• /games/list?today=true — матчи за сегодня.
          <br>• /games/list?Date=YYYY-MM-DD&amp;CountryId=&lt;id&gt;&amp;LeagueId=&lt;id&gt; — фильтры по дате, стране и лиге (точные названия параметров смотрите в документации на SStats.net). [web:4]
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Выбранный матч</span>
          <span class="panel-badge">games/&lt;id&gt;</span>
        </div>
        <div class="selected-game" id="selectedGame">
          <span>Нет выбранного матча.</span><br>
          Кликните по карточке матча слева, чтобы увидеть детали и открыть JSON.
        </div>
        <div class="hint" style="margin-top: 8px;">
          При клике по матчу открывается точка /games/&lt;GameId&gt; в новом окне, где доступны расширенные данные: события, коэффициенты и статистика, если они предоставляются вашим тарифом API. [web:2][web:4]
        </div>
      </div>

      <div class="panel">
        <div class="key-label">
          <span class="key-dot"></span>
          <span>API ключ</span>
        </div>
        <div class="hint">
          Укажите ваш ключ SStats.net в переменной <code>API_KEY</code> в JS‑коде ниже. [web:2]<br>
          Ключ можно получить в личном кабинете на SStats.net; бесплатный тариф имеет ограничения по частоте запросов. [web:2]
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  const API_BASE = 'https://api.sstats.net';
  const API_KEY = 'YOUR_API_KEY_HERE'; // TODO: замените на ваш ключ или оставьте пустым, если API без ключа

  const dateInput = document.getElementById('dateInput');
  const countrySelect = document.getElementById('countrySelect');
  const leagueSelect = document.getElementById('leagueSelect');
  const btnLoad = document.getElementById('btnLoad');
  const btnToday = document.getElementById('btnToday');
  const matchesListEl = document.getElementById('matchesList');
  const summaryTextEl = document.getElementById('summaryText');
  const summaryCountEl = document.getElementById('summaryCount');
  const errorBoxEl = document.getElementById('errorBox');
  const requestPreviewEl = document.getElementById('requestPreview');
  const selectedGameEl = document.getElementById('selectedGame');

  function setToday() {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    dateInput.value = yyyy + '-' + mm + '-' + dd;
  }

  function setError(msg) {
    if (!msg) {
      errorBoxEl.textContent = '';
      return;
    }
    errorBoxEl.textContent = msg;
  }

  function buildHeaders() {
    const headers = { 'Accept': 'application/json' };
    if (API_KEY) headers['X-Api-Key'] = API_KEY;
    return headers;
  }

  function updateRequestPreview(url) {
    const lines = [];
    lines.push('GET ' + url);
    lines.push('Accept: application/json');
    if (API_KEY) {
      lines.push('X-Api-Key: ' + API_KEY);
    } else {
      lines.push('# X-Api-Key: <не указан>');
    }
    requestPreviewEl.textContent = lines.join('\n');
  }

  async function fetchJson(url) {
    const res = await fetch(url, { headers: buildHeaders() });
    if (!res.ok) {
      throw new Error('HTTP ' + res.status + ' ' + res.statusText);
    }
    return res.json();
  }

  // -------- Countries & Leagues loading ----------
  async function loadCountries() {
    try {
      // Точный endpoint для стран смотрите в docs SStats (ниже — примерный вариант)
      const url = API_BASE + '/countries/list';
      const data = await fetchJson(url);
      const items = Array.isArray(data) ? data : (data.data || []);
      items.sort((a,b) => (a.Name || a.name || '').localeCompare(b.Name || b.name || ''));
      for (const item of items) {
        const opt = document.createElement('option');
        opt.value = item.Id || item.CountryId || item.id;
        opt.textContent = (item.Name || item.name || 'Страна') +
          (item.Code || item.code ? ' (' + (item.Code || item.code) + ')' : '');
        countrySelect.appendChild(opt);
      }
    } catch (e) {
      console.warn('Ошибка загрузки стран', e);
      setError('Не удалось загрузить список стран (проверьте endpoint /countries/list и ключ API).');
    }
  }

  async function loadLeaguesForCountry(countryId) {
    leagueSelect.innerHTML = '<option value="">Все лиги</option>';
    if (!countryId) return;

    try {
      // Примерный endpoint для лиг внутри страны; корректный путь берите из документации.
      const url = API_BASE + '/leagues/list?CountryId=' + encodeURIComponent(countryId);
      const data = await fetchJson(url);
      const items = Array.isArray(data) ? data : (data.data || []);
      items.sort((a,b) => (a.Name || a.name || '').localeCompare(b.Name || b.name || ''));
      for (const item of items) {
        const opt = document.createElement('option');
        opt.value = item.Id || item.LeagueId || item.id;
        opt.textContent = (item.Name || item.name || 'Лига');
        leagueSelect.appendChild(opt);
      }
    } catch (e) {
      console.warn('Ошибка загрузки лиг', e);
      setError('Не удалось загрузить лиги для выбранной страны (проверьте endpoint /leagues/list).');
    }
  }

  countrySelect.addEventListener('change', () => {
    const cid = countrySelect.value;
    loadLeaguesForCountry(cid);
  });

  // -------- Matches ----------
  function buildGamesUrl() {
    const params = new URLSearchParams();
    const date = dateInput.value;
    const countryId = countrySelect.value;
    const leagueId = leagueSelect.value;

    if (date) {
      // В документации может быть Date, GameDate или другой параметр — замените, если нужно.
      params.append('Date', date);
    } else {
      params.append('today', 'true');
    }
    if (countryId) params.append('CountryId', countryId);
    if (leagueId) params.append('LeagueId', leagueId);

    const url = API_BASE + '/games/list?' + params.toString();
    return url;
  }

  function renderMatches(matches) {
    matchesListEl.innerHTML = '';

    if (!matches || matches.length === 0) {
      const div = document.createElement('div');
      div.className = 'empty';
      div.textContent = 'По указанным фильтрам матчи не найдены.';
      matchesListEl.appendChild(div);
      return;
    }

    matches.forEach(match => {
      const card = document.createElement('article');
      card.className = 'match-card';

      const homeName = match.HomeTeamName || match.home_team || 'Домашняя команда';
      const awayName = match.AwayTeamName || match.away_team || 'Гости';
      const leagueName = match.LeagueName || match.league_name || 'Лига';
      const countryName = match.CountryName || match.country_name || '';
      const round = match.Round || match.round || null;

      const dateRaw = match.Date || match.date || match.StartTime || match.start_time;
      let dateStr = 'Время не указано';
      if (dateRaw) {
        const d = new Date(dateRaw);
        if (!isNaN(d.getTime())) {
          dateStr = d.toLocaleString('ru-RU', {
            day: '2-digit',
            month: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
        } else {
          dateStr = String(dateRaw);
        }
      }

      const statusRaw = (match.Status || match.status || '').toString().toLowerCase();
      let statusText = 'Запланирован';
      let statusClass = 'pill-status-upcoming';
      if (statusRaw.includes('live') || statusRaw.includes('inplay') ||
          statusRaw.includes('1st') || statusRaw.includes('2nd')) {
        statusText = 'В игре';
        statusClass = 'pill-status-live';
      } else if (statusRaw.includes('finished') || statusRaw.includes('ended') || statusRaw === 'ft') {
        statusText = 'Завершён';
        statusClass = 'pill-status-finished';
      }

      const teamsEl = document.createElement('div');
      teamsEl.className = 'match-teams';
      teamsEl.innerHTML = `
        <div class="match-team-row">
          <span class="team-name">${homeName}</span>
        </div>
        <div class="match-vs">VS</div>
        <div class="match-team-row">
          <span class="team-name">${awayName}</span>
        </div>
      `;

      const infoEl = document.createElement('div');
      infoEl.innerHTML = `
        <div class="match-info-line">${leagueName}${countryName ? ' · ' + countryName : ''}</div>
        <div class="match-info-date">${dateStr}</div>
      `;

      const extraEl = document.createElement('div');
      extraEl.className = 'match-extra';
      extraEl.innerHTML = `
        <div class="pill-small ${statusClass}">${statusText}</div>
        ${round ? `<div class="pill-small">Тур ${round}</div>` : ''}
      `;

      const gameId = match.Id || match.GameId || match.game_id;
      if (gameId) {
        card.addEventListener('click', () => {
          const gameUrl = API_BASE + '/games/' + gameId;
          selectedGameEl.innerHTML = `
            Матч: <strong>${homeName} — ${awayName}</strong><br>
            <span>${leagueName}${countryName ? ' · ' + countryName : ''}</span><br>
            <span>Статус: ${statusText}, ID: ${gameId}</span><br>
            <span>Открываем: ${gameUrl}</span>
          `;
          window.open(gameUrl, '_blank');
        });
        card.title = 'Открыть детали матча в /games/' + gameId;
      }

      card.appendChild(teamsEl);
      card.appendChild(infoEl);
      card.appendChild(extraEl);
      matchesListEl.appendChild(card);
    });
  }

  async function loadMatches() {
    const url = buildGamesUrl();
    updateRequestPreview(url);
    setError('');
    summaryTextEl.textContent = 'Загружаем матчи…';
    btnLoad.disabled = true;

    try {
      const data = await fetchJson(url);
      let matches = Array.isArray(data) ? data : (data.data || data.games || data.items || []);
      if (!Array.isArray(matches)) matches = [];

      // сортировка по времени
      matches.sort((a,b) => {
        const da = new Date(a.Date || a.StartTime || a.date || a.start_time || 0).getTime();
        const db = new Date(b.Date || b.StartTime || b.date || b.start_time || 0).getTime();
        return da - db;
      });

      renderMatches(matches);
      summaryCountEl.textContent = matches.length + ' матчей';
      const dateLabel = dateInput.value || 'сегодня';
      summaryTextEl.textContent = 'Загружено матчей: ' + matches.length + ' (дата: ' + dateLabel + ').';
    } catch (e) {
      console.error(e);
      setError('Ошибка загрузки матчей: ' + e.message + '. Проверьте ключ API и параметры запроса /games/list в документации.');
      summaryTextEl.textContent = 'Не удалось загрузить матчи.';
      summaryCountEl.textContent = '0 матчей';
      matchesListEl.innerHTML = '<div class="empty">Не удалось загрузить данные. Попробуйте ещё раз или проверьте настройки API.</div>';
    } finally {
      btnLoad.disabled = false;
    }
  }

  // -------- Events ----------
  btnLoad.addEventListener('click', () => {
    loadMatches();
  });

  btnToday.addEventListener('click', () => {
    setToday();
    loadMatches();
  });

  // инициализация
  setToday();
  loadCountries(); // загрузка стран при старте
  // по желанию можно сразу загрузить сегодняшние матчи:
  // loadMatches();
</script>
</body>
</html>
